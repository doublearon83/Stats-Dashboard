---
title: "Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(knitr)
library(shiny)
library(crosstalk)
library(DT)
library(plotly)
library(scales)
library(png)
library(r2symbols)
library(kableExtra)
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=F)

#MPO
placedata <- read.csv("Place_data.csv")
placedata <- placedata[,-1]
names(placedata) <- c("Place", "Statistic", "Percent")
placedata$Percent <- round(placedata$Percent,1)
tdata_p <- SharedData$new(placedata)

strokedata <- read.csv("Stroke_data.csv")
strokedata <- strokedata[,-1]
names(strokedata) <- c("Percent", "Statistic", "Strokes")
strokedata$Strokes <- round(strokedata$Strokes,1)
strokedata$Percent <- round(strokedata$Percent,1)
strokedata$Type <- c(rep("Prediction",100),rep("Observed",8))
tdata_s <- SharedData$new(strokedata)
```


Stats Dashboard
======================================================================= 

Inputs {.sidebar}
-----------------------------------------------------------------------

Use the boxes below to subset statistics of interest into the two plots.

```{r}
filter_select("Statistic", "Choose % Stat (Top plot)", tdata_p, ~Statistic)
```

```{r}
filter_select("Statistic", "Choose Stroke Stat (Bottom plot)", tdata_s, ~Statistic)
```

Column {data-width=450}
-----------------------------------------------------------------------

### Plot of average statistic percentage (%) by finishing place

```{r}
lm.mod<-lm(Percent ~ Place*Statistic+I(Place^2)*Statistic,data=placedata)
Prediction <- predict(lm.mod)
g <- ggplot(tdata_p,aes(Place,Percent,group=Statistic)) + 
  geom_line(aes(color=Statistic),alpha=0.25) +
  geom_line(aes(y=Prediction,color=Statistic)) +
  scale_color_manual(values = c("C1P (%)" = "black", "C1R (%)" = "red"))+
  xlab("Finishing Place") +
  ylab("Statistic Percentage (%)")

ggplotly(g,tooltip = c("group", "x", "y"))%>%
    layout (
           yaxis = list(rangemode="normal"))
```

### Plot of strokes saved by statistic percentage (%)

```{r}
col=c(rep("black",100),rep("red",8))
s <- c(rep(1,100),rep(2,8)) 
al <- c(rep(0.5,100),rep(1,8))
h <- ggplot() + 
  geom_point(data=tdata_s,aes(Percent,Strokes,group=Statistic,color=Type),size=s,alpha=al) +
  scale_color_manual(values = c("Prediction" = "black", "Observed" = "red"))+
  xlab("Statistic Percentage (%)") +
  xlim(30,100)+
  ylab("Strokes Saved")

ggplotly(h,tooltip = c("x", "y","group"))%>%
    layout(
           yaxis = list(rangemode="normal"))
```

Column {data-width=400}
-----------------------------------------------------------------------